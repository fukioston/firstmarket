<!DOCTYPE html>
<html>

<head>
    <meta charset="utf=8">
    <title>ä¸Šä¼ å•†å“</title>
    <link href="../css/upload.css" rel="stylesheet" type="text/css">
    <script type="text/javascript">
      function popDiv(){
          var popBox = document.getElementById("popup");
          var popLayer =document.getElementById("poplayer");
          popBox.style.display="block";
          popLayer.style.display = "block";
      }
      function closePop(){
          let popDiv =document.getElementById("popup");
          popDiv.style.display="none";
      function closePop2(){
          let popDiv =document.getElementById("popup");
          popDiv.style.display="none";
      }
      }
      </script>
</head>

<body>
  <div id="popup" class="modal"> <!-- é®ç½©å±‚ -->
    <div class="container">
        <p>
        <h2>ç¡®è®¤é€€å‡ºç™»å½•ï¼Ÿ</h2>
        </p>
        <div class="close">
            <a href="javascript:void(0)" onclick="closePop();">X</a>
        </div>
        <div class="back">
            <button class="button1" onclick="window.location.href='./login.html'">ç¡®è®¤</button>
            <button class="button2" onclick="closePop();">å–æ¶ˆ</button>
        </div>
    </div>
</div>
<other>
<ul>
    <li class="logo"><img src="../htmlpictures/logo2.jpg" alt="MAIDONGDONG" height="60px"></li>
    <li><a href="./main.html">é¦–é¡µ</a></li>
    <li><a href="./userCenter.html">ä¸ªäººä¸­å¿ƒ</a></li>
    <li><a href="./collect.html">æˆ‘çš„æ”¶è—</a></li>
    <li><a  href="./mygoods.html">æˆ‘çš„å•†å“</a></li>
    <li><a class="active"href="./upload.html">å•†å“ä¸Šä¼ </a></li>
    <li id="poplayer" style="float:right;"><a class="right" href="javascript:void(0)" onclick="popDiv();">é€€å‡ºç™»å½•</a></li>
    <li style="float:right;"><a id="login" class="right" href="./login.html">ç™»å½•</a></li>
    <li style="float:right;"><a id="register" class="right" href="./register.html">æ³¨å†Œ</a></li>  
</ul>
<div class="buchong"></div>
  
<div class="PictureContainer">
  <div class="pic" >
  <input  class="uploadinput" id="uploadpic" style="position: absolute; top: 0; bottom: 0; left: 0;right: 0; opacity: 0;" type="file" />
  <!-- è®¾ç½®å•†å“ç•Œé¢çš„å›¾ç‰‡ -->
  <img id="commoditypicture" src="../htmlpictures/jiahao.jpg"  alt="è¯·ä¸Šä¼ å›¾ç‰‡" title="preview-img" class="Picture active">
</div>
</div>

<div class="information">
  <section>
  <div style="padding-left: 140px;"><h2>ğŸ˜ä¸Šä¼ å•†å“ä¿¡æ¯ğŸ˜</h2></div>
  <li style="list-style: none; font-size: 23px;">ğŸå•†å“åç§°ğŸï¼š</li>
  <input id="name" class="nameinput" type="text" >
  <li style="list-style: none; font-size: 23px;" >ğŸ’´é¢„ä¼°ä»·æ ¼ğŸ’´ï¼š</li>
  <input id="money" class="nameinput" type="text" >
  <li style="list-style: none; font-size: 23px;">ğŸ“¢è”ç³»æ–¹å¼ğŸ“¢ï¼š</li>
  <input id="connectnum"class="nameinput" type="text" >
  <li style="list-style: none; font-size: 23px;">ğŸ“™å•†å“ä»‹ç»ğŸ“™ï¼š</li>
  <textarea id="introduction" class="beizhu"></textarea>
  <div style="padding-left: 100px;"><button id="uploadBtn" class="buttons1">ç¡®å®šä¸Šä¼ </button><a href="./main.html"><button class="buttons2">è¿”å›</button></a></div>
  </section>
</div>


<script src="../js/jquery.min.js"></script>
<script>
  isLogin();
function isLogin(){
$.ajax({
   url:'/api/islogin',
   type:'get',
   headers:{
       Authorization:localStorage.token
   },
   success(msg){if(msg.status){alert('ä½ è¿˜æ²¡æœ‰ç™»å½•')
   location.href="./login.html"}
   else{
            var a1 = document.getElementById("login");
        a1.innerHTML = msg.data.name  ;
        var a2 = document.getElementById("register");
        a2.innerHTML ='';
        }},
   error(err){
if(err.status==401){alert('ä½ è¿˜æ²¡æœ‰ç™»å½•')
location.href="./login.html"
}     }
    })
    }
$('#uploadpic').change(function(event){
            //1.è·å–ç›¸å…³ä¿¡æ¯
            console.log('hahah')
              const files=this.files;
              //å°†è·å–çš„å›¾ç‰‡ä¿¡æ¯æ·»åŠ åˆ°è¡¨å•å¯¹è±¡FormData
              const formdata=new FormData();
              formdata.append('file',files[0]);
              console.log(files[0])
            //   é€šè¿‡ajaxå°†è¡¨å•å¯¹è±¡å‘é€åˆ°æœåŠ¡å™¨
            $.ajax({
                url:'/commodity/uploadpic',
                type:'post',
                data:formdata,
                //ä¸é‡‡å–ç¼“å­˜ä¸­ç»“æœ
                cache:false,
                //æ•°æ®ç¼–ç æ ¼å¼ä¸é€‚ç”¨jqueryæ–¹å¼
                contentType:false,
                //å‘é€çš„å›¾ç‰‡æ•°æ®ä¸è½¬åŒ–ä¸ºå…¶ä»–æ ¼å¼
                processData:false,
                success(msg){console.log(msg.data)
                   
                    $('#commoditypicture').attr('src',`../picture/${msg.data}`)
                                      .data('src',msg.data)
                                      //$('#wodezhaopian').data('src')å¯ä»¥è·å–åä¼ åˆ°uploadï¼Œæ¥ç€æ¥åˆ°æ¥å£
                                     
                                    }

            }
            )

        })
        $('#uploadBtn').click(
    function(){

          const name=$('#name').val();
          const money=$('#money').val();
        const introduction=$('#introduction').val();
        const connectnum=$('#connectnum').val();
        const picturename=$('#commoditypicture').data('src');
        
$.ajax({
        url:'/commodity/upload',
        headers:{
            Authorization:localStorage.token
        },
        data:{
            name,introduction,connectnum,picturename,money
            
        },
        type:'post',
        success(msg){
            
            if(!msg.status)
            {alert('ä¸Šä¼ æˆåŠŸ') 
            
            location.href="./main.html"
              }
            else alert(msg.message)
        }
    })



    }
  )
 </script>
</body>

</html>
